<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Llamas — Welcome</title>
  <!-- Mapbox GL JS for the globe -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1220; --card:#111827; --text:#e5e7eb; --muted:#9aa3af;
      --accent:#60a5fa; --accent-2:#22d3ee; --ring:#ffffff; --border:#1f2937;
      --shadow:0 18px 40px rgba(2,6,23,.45);
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin-inline:auto;padding:20px}

    /* HERO */
    .hero{position:relative;border-radius:16px;overflow:hidden;box-shadow:var(--shadow);background:#0a0a0f}
    
    /* Unified starry background across entire hero */
    .hero::after{
      content:'';
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background:
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.9), transparent),
        radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 160px 30px, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 200px 60px, rgba(255,255,255,0.8), transparent),
        radial-gradient(2px 2px at 240px 20px, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 280px 50px, rgba(255,255,255,0.9), transparent),
        radial-gradient(1px 1px at 320px 90px, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 360px 40px, rgba(255,255,255,0.5), transparent);
      background-repeat:repeat;
      background-size:400px 200px;
      animation:twinkle 4s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:1;
    }
    
    @keyframes twinkle{
      0%{opacity:0.3;}
      100%{opacity:0.8;}
    }

    .hero-header{padding:20px 24px;text-align:center;background:transparent;width:100%;box-sizing:border-box;position:relative}
    .hero-header::before{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(15,23,42,0.9) 0%,rgba(15,23,42,0.6) 50%,transparent 100%);pointer-events:none;z-index:2}
    .title{margin:0;font-size:clamp(28px,5vw,42px);font-weight:900;letter-spacing:.2px;position:relative;z-index:3;text-shadow:0 2px 4px rgba(0,0,0,0.3)}
    .note{margin:0 auto;margin-top:6px;color:var(--muted);max-width:500px;font-size:0.9rem;position:relative;z-index:3;text-shadow:0 1px 2px rgba(0,0,0,0.2)}

    /* GLOBE */
    .hero-globe{position:relative;height:450px;width:100%;border-radius:0 0 16px 16px;overflow:hidden;background:transparent}
    #welcome-globe{width:100%;height:100%;position:relative;z-index:2}
    
    /* Make map blend better with starry background */
    #welcome-globe .mapboxgl-canvas{
      mix-blend-mode:soft-light;
      opacity:0.85;
    }
    
    /* Ensure mapbox controls remain visible */
    #welcome-globe .mapboxgl-ctrl{
      z-index:5 !important;
    }
    
    /* Add subtle overlay to further fade map boundaries */
    #welcome-globe::after{
      content:'';
      position:absolute;
      inset:0;
      background:radial-gradient(circle at center, transparent 0%, rgba(10,10,15,0.1) 60%, rgba(10,10,15,0.3) 100%);
      pointer-events:none;
      z-index:1;
    }
    
    /* Globe markers */
    .globe-marker{
      width:10px;
      height:10px;
      border-radius:50%;
      border:2px solid rgba(96,165,250,0.9);
      background:rgba(96,165,250,0.8);
      box-shadow:0 0 8px rgba(96,165,250,0.6), 0 0 16px rgba(96,165,250,0.3);
      transition:all 0.3s ease;
      animation:globePulse 3s ease-in-out infinite;
      cursor:pointer;
      position:relative;
      z-index:10;
    }
    
    .globe-marker.photo-bubble{
      background:rgba(34,211,238,0.95);
      border-color:rgba(34,211,238,1);
      box-shadow:0 0 12px rgba(34,211,238,0.8), 0 0 24px rgba(34,211,238,0.5);
      z-index:15;
    }
    
    .globe-marker:hover{
      transform:scale(1.3);
      border-color:rgba(34,211,238,1);
      background:rgba(34,211,238,1);
      box-shadow:0 0 16px rgba(34,211,238,0.9), 0 0 32px rgba(34,211,238,0.6);
      z-index:20;
    }
    
    @keyframes globePulse{
      0%,100%{
        box-shadow:0 0 12px rgba(96,165,250,0.6), 0 0 24px rgba(96,165,250,0.3);
        opacity:1;
      }
      50%{
        box-shadow:0 0 16px rgba(96,165,250,0.8), 0 0 32px rgba(96,165,250,0.5);
        opacity:0.9;
      }
    }
    
    /* Mapbox attribution styling - subtle by default, visible on hover */
    .mapboxgl-ctrl-attrib {
      background: transparent !important;
      color: transparent !important;
      border: none !important;
      box-shadow: none !important;
      padding: 2px 4px !important;
      font-size: 10px !important;
      opacity: 0.3 !important;
      transition: all 0.3s ease !important;
    }
    
    .mapboxgl-ctrl-attrib:hover {
      background: rgba(0,0,0,0.8) !important;
      color: rgba(255,255,255,0.9) !important;
      opacity: 0.9 !important;
      border-radius: 4px !important;
      backdrop-filter: blur(4px) !important;
    }
    
    .mapboxgl-ctrl-attrib-button {
      background: transparent !important;
      color: rgba(255,255,255,0.4) !important;
      border: none !important;
      font-size: 12px !important;
      font-weight: bold !important;
      margin: 0 !important;
      padding: 2px 4px !important;
      transition: all 0.3s ease !important;
      cursor: pointer !important;
    }
    
    .mapboxgl-ctrl-attrib-button:hover {
      color: rgba(255,255,255,0.9) !important;
      background: rgba(255,255,255,0.1) !important;
      border-radius: 2px !important;
    }
    
    /* Style the attribution text when expanded */
    .mapboxgl-ctrl-attrib.mapboxgl-compact-show {
      background: rgba(0,0,0,0.85) !important;
      color: rgba(255,255,255,0.9) !important;
      border-radius: 4px !important;
      padding: 4px 8px !important;
      backdrop-filter: blur(8px) !important;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
    }
    
    .mapboxgl-ctrl-attrib a {
      color: rgba(255,255,255,0.8) !important;
      text-decoration: none !important;
    }
    
    .mapboxgl-ctrl-attrib a:hover {
      color: rgba(255,255,255,1) !important;
      text-decoration: underline !important;
    }

    /* ADVENTURE SECTION */
    .adventure-section{margin-top:60px;padding:40px 0}
    .adventure-header{text-align:center;margin-bottom:40px}
    .adventure-badge{
      display:inline-block;
      background:rgba(96,165,250,0.8);
      color:white;
      padding:6px 12px;
      border-radius:12px;
      font-size:0.75rem;
      font-weight:600;
      letter-spacing:0.3px;
      margin-bottom:16px;
      box-shadow:0 2px 6px rgba(96,165,250,0.2);
    }
    
    .adventure-title{
      font-size:clamp(24px, 4vw, 32px);
      font-weight:700;
      margin:0 0 16px;
      color:var(--text);
      letter-spacing:-0.2px;
    }
    
    .adventure-subtitle{
      font-size:1.1rem;
      color:var(--muted);
      max-width:600px;
      margin:0 auto;
      line-height:1.6;
    }
    
    .adventure-grid{
      display:flex;
      justify-content:center;
      max-width:500px;
      margin:0 auto;
    }
    
    .adventure-card{
      background:var(--panel);
      border-radius:20px;
      overflow:hidden;
      cursor:pointer;
      transition:all 0.3s ease;
      border:2px solid transparent;
      position:relative;
      width:100%;
      max-width:450px;
    }
    
    .adventure-card:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(0,0,0,0.15);
      border-color:rgba(96,165,250,0.3);
    }
    
    .adventure-card.current{
      background:var(--panel);
      border-color:rgba(96,165,250,0.2);
      box-shadow:0 4px 20px rgba(96,165,250,0.1);
    }
    
    .adventure-status{
      position:absolute;
      top:16px;
      right:16px;
      z-index:10;
    }
    
    .status-badge{
      background:rgba(0,0,0,0.8);
      color:white;
      padding:6px 12px;
      border-radius:20px;
      font-size:0.75rem;
      font-weight:700;
      backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,0.1);
    }
    
    .status-badge.live{
      background:#ef4444;
      font-weight:700;
      opacity:0.9;
    }
    
    .adventure-media{
      height:200px;
      background-size:cover;
      background-position:center;
      position:relative;
      overflow:hidden;
    }
    
    .adventure-overlay{
      position:absolute;
      inset:0;
      background:linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.4) 70%, rgba(0,0,0,0.8) 100%);
      display:flex;
      align-items:flex-end;
      padding:20px;
      opacity:0;
      transition:opacity 0.3s ease;
    }
    
    .adventure-card:hover .adventure-overlay{
      opacity:1;
    }
    
    .adventure-stats{
      display:flex;
      gap:20px;
      color:white;
    }
    
    .stat{
      text-align:center;
    }
    
    .stat-number{
      display:block;
      font-size:1.5rem;
      font-weight:900;
      line-height:1;
    }
    
    .stat-label{
      font-size:0.8rem;
      opacity:0.9;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    
    .adventure-content{
      padding:24px;
    }
    
    .adventure-name{
      font-size:1.4rem;
      font-weight:900;
      margin:0 0 12px;
      color:var(--text);
    }
    
    .adventure-description{
      color:var(--muted);
      line-height:1.6;
      margin:0 0 16px;
    }
    
    .adventure-meta{
      display:flex;
      justify-content:center;
      align-items:center;
      margin-bottom:20px;
    }
    
    .adventure-date{
      color:var(--accent);
      font-weight:700;
      font-size:1rem;
      text-align:center;
    }
    
    .cta-button{
      background:var(--accent);
      color:white;
      border:none;
      padding:10px 18px;
      border-radius:8px;
      font-weight:600;
      font-size:0.9rem;
      cursor:pointer;
      transition:all 0.2s ease;
      display:flex;
      align-items:center;
      gap:8px;
      width:100%;
      justify-content:center;
      opacity:0.9;
    }
    
    .cta-button:hover{
      opacity:1;
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(96,165,250,0.2);
    }
    

    
    .cta-arrow{
      transition:transform 0.2s ease;
    }
    
    .cta-button:hover .cta-arrow{
      transform:translateX(2px);
    }
    

    
    /* ENHANCED FOOTER */
    .enhanced-footer{
      background:linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color:#cbd5e1;
      padding:40px 0 20px;
      margin-top:40px;
      position:relative;
      overflow:hidden;
    }
    
    .footer-content{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      flex-wrap:wrap;
      gap:20px;
      position:relative;
      z-index:2;
    }
    
    .footer-brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }
    
    .footer-logo{
      font-size:1.5rem;
    }
    
    .footer-name{
      font-size:1.2rem;
      font-weight:900;
      color:white;
    }
    
    .footer-tagline{
      color:#94a3b8;
      font-size:0.9rem;
      margin:0;
      max-width:300px;
    }
    
    .footer-links{
      display:flex;
      gap:24px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    
    .footer-link{
      color:#cbd5e1;
      text-decoration:none;
      font-weight:500;
      transition:color 0.3s ease;
    }
    
    .footer-link:hover{
      color:white;
    }
    
    .footer-copyright{
      color:#64748b;
      font-size:0.85rem;
      margin:0;
    }
    
    .footer-decoration{
      position:absolute;
      inset:0;
      overflow:hidden;
      z-index:1;
    }
    
    .footer-stars{
      position:absolute;
      width:200%;
      height:200%;
      background:
        radial-gradient(1px 1px at 20px 30px, rgba(255,255,255,0.3), transparent),
        radial-gradient(1px 1px at 40px 70px, rgba(255,255,255,0.2), transparent),
        radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.4), transparent),
        radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.3), transparent),
        radial-gradient(1px 1px at 160px 30px, rgba(255,255,255,0.2), transparent);
      background-repeat:repeat;
      background-size:200px 150px;
      animation:footer-drift 60s linear infinite;
    }
    
    @keyframes footer-drift{
      from{transform:translateX(0) translateY(0);}
      to{transform:translateX(-50px) translateY(-50px);}
    }
    
    /* Mobile responsive */
    @media (max-width:768px){
      .hero-header{padding:16px 20px}
      .hero-globe{height:350px}
      .title{font-size:clamp(26px,4.5vw,36px)}
      .adventure-grid{max-width:400px}
      .adventure-card{max-width:400px}
      .footer-content{flex-direction:column;text-align:center}
      .footer-links{justify-content:center}
    }
    @media (max-width:560px){
      .wrap{padding:16px}
      .hero-header{padding:14px 16px}
      .hero-globe{height:280px}
      .title{font-size:clamp(22px,4vw,28px)}
      .note{font-size:0.85rem}
      .adventure-section{padding:20px 0}
      .adventure-header{margin-bottom:30px}
      .adventure-grid{max-width:320px}
      .adventure-card{max-width:320px}
    }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-header">
        <h1 class="title">Find 🦙 Llamas</h1>
      </div>
      <div class="hero-globe">
        <div id="welcome-globe"></div>
      </div>
    </section>

    <!-- ADVENTURE SECTION -->
    <section class="adventure-section" id="adventures">
      <div class="adventure-header">
        <div class="adventure-badge">📍 Currently Traveling</div>
        <h2 class="adventure-title">Our Current Trip</h2>
        <p class="adventure-subtitle">No login required! Leave your name in comments so you're not called "anonymous". We post to our diary every evening with daily updates from our travels.</p>
      </div>
      
      <div class="adventure-grid">
        <article class="adventure-card current" onclick="openTrip('japan-korea')" tabindex="0">
          <div class="adventure-status">
            <span class="status-badge live">🔴 LIVE NOW</span>
          </div>
          <div class="adventure-media" style="background-image:url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1400&auto=format&fit=crop');">
            <div class="adventure-overlay">
              <div class="adventure-stats">
                <div class="stat">
                  <span class="stat-number" id="city-count">0</span>
                  <span class="stat-label">Cities</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="gps-photo-count">0</span>
                  <span class="stat-label">GPS Photos</span>
                </div>
                <div class="stat">
                  <span class="stat-number" id="day-count">0</span>
                  <span class="stat-label">Days</span>
                </div>
              </div>
            </div>
          </div>
          <div class="adventure-content">
            <h3 class="adventure-name">Japan & South Korea 🇯🇵🇰🇷</h3>
            <p class="adventure-description">Exploring cities in Japan and South Korea, sharing daily updates from our travels</p>
            <div class="adventure-meta">
              <span class="adventure-date">Aug–Oct 2025</span>
            </div>
            <div class="adventure-cta">
              <button class="cta-button">
                <span class="cta-icon">📖</span>
                View Travel Diary
                <span class="cta-arrow">→</span>
              </button>
            </div>
          </div>
        </article>
        

      </div>
    </section>



    <!-- ENHANCED FOOTER -->
    <footer class="enhanced-footer">
      <div class="footer-content">
        <div class="footer-left">
          <div class="footer-brand">
            <span class="footer-logo">🦙</span>
            <span class="footer-name">Find Llamas</span>
          </div>
          <p class="footer-tagline">Privacy-first travel adventures for curious humans</p>
        </div>
        <div class="footer-right">
          <div class="footer-links">
            <a href="#" class="footer-link">About</a>
            <a href="#" class="footer-link">Privacy</a>
            <a href="#" class="footer-link">Contact</a>
          </div>
          <p class="footer-copyright">© 2025 Find Llamas</p>
        </div>
      </div>
      <div class="footer-decoration">
        <div class="footer-stars"></div>
      </div>
    </footer>
  </main>
  <script type="module">
    import { groupIntoStacks } from './js/utils.js';

    function openTrip(slug){
      if(slug==='japan-korea'){
        window.location.href='/index.html?trip=japan-korea';
      }
    }
    

    
    const GEO_CACHE_KEY = "reverse_geocode_cache";
    let geocodeCache = JSON.parse(localStorage.getItem(GEO_CACHE_KEY) || "{}");

    const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

    async function fetchWithTimeout(resource, options = {}) {
      const { timeout = 8000 } = options;
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      try {
        const response = await fetch(resource, { ...options, signal: controller.signal });
        clearTimeout(id);
        return response;
      } catch (err) {
        clearTimeout(id);
        throw err;
      }
    }

    async function reverseGeocode(lat, lon) {
      const key = `${lat.toFixed(5)},${lon.toFixed(5)}`;
      if (geocodeCache[key]) return geocodeCache[key];
      const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;
      try {
        const res = await fetchWithTimeout(url, {
          headers: {
            "User-Agent": "FindPenguinApp/1.0 (your_email@example.com)",
            "Accept-Language": "en",
          },
          timeout: 8000,
        });
        if (!res.ok) {
          console.warn("Reverse geocode failed:", res.status, await res.text());
          return `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        }
        const data = await res.json();
        const addr = data.address || {};
        const district = addr.suburb || addr.city_district || addr.district || addr.borough || addr.ward;
        const city = addr.city || addr.town || addr.village || addr.municipality || addr.locality;
        const region = addr.state || addr.region || addr.province || addr.state_district;
        const country = addr.country;
        let nameParts = [city, district, country].filter(Boolean);
        nameParts = nameParts.filter((part, idx) => nameParts.indexOf(part) === idx);
        const name = nameParts.length > 0 ? nameParts.join(", ") : `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        geocodeCache[key] = name;
        localStorage.setItem(GEO_CACHE_KEY, JSON.stringify(geocodeCache));
        return name;
      } catch (e) {
        console.warn("Reverse geocode failed:", e);
        return `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
      }
    }

    // Load actual photo data and create bubbles
    async function loadPhotoData() {
      try {
        const response = await fetch('/data/days/index.json');
        const days = await response.json();

        let dayDataList = [];
        let flatPhotos = [];
        let totalPhotoCount = 0;

        for (const day of days) {
          try {
            const dayResponse = await fetch(`/data/days/${day.slug}.json`);
            const dayData = await dayResponse.json();
            if (dayData.photos && dayData.photos.length > 0) {
              dayDataList.push({
                date: dayData.date,
                title: dayData.title,
                photoCount: dayData.photos.length,
                photos: dayData.photos
              });
              flatPhotos.push(...dayData.photos);
              totalPhotoCount += dayData.photos.length;
            }
          } catch (e) {
            console.log(`Could not load day: ${day.slug}`);
          }
        }

        const stacks = groupIntoStacks(flatPhotos, 500);
        const citySet = new Set();
        for (const s of stacks) {
          const { lat, lng } = s.location;
          if (Number.isFinite(lat) && Number.isFinite(lng)) {
            await delay(1100);
            const label = await reverseGeocode(lat, lng);
            s.location.label = label;
            const city = label.split(',')[0].trim();
            if (city) citySet.add(city);
          }
        }

        console.log(`Loaded ${totalPhotoCount} photos from ${dayDataList.length} travel days`);
        return { dayDataList, totalPhotoCount, stacks, uniqueCityCount: citySet.size };
      } catch (e) {
        console.log('Using fallback photo data');
        return { dayDataList: [], totalPhotoCount: 0, stacks: [], uniqueCityCount: 0 };
      }
    }

    // Initialize the satellite globe
    async function initGlobe() {
      // Set up Mapbox token (using the same one from main app)
      mapboxgl.accessToken = 'pk.eyJ1IjoianVkZ2UtbW9ja3VwLXdoYW0iLCJhIjoiY21lb3M4dHJiMGUxcjJqcXZ4YzZwZjhubSJ9.EptPsUdI5bt2hOIZfZL3Yg';
      
      const map = new mapboxgl.Map({
        container: 'welcome-globe',
        style: 'mapbox://styles/mapbox/satellite-v9',
        zoom: 2.5, // More zoomed in to better show the travel region
        center: [135, 35], // Centered on Japan/Korea region
        projection: 'globe', // This creates the 3D globe effect
        antialias: true,
        interactive: true,
        attributionControl: false // Disable default attribution control
      });
      
      // Add custom attribution control with subtle styling
      map.addControl(new mapboxgl.AttributionControl({
        compact: true,
        customAttribution: ''
      }), 'bottom-left');
      
      // Load actual photo data
      const { dayDataList, totalPhotoCount, stacks, uniqueCityCount } = await loadPhotoData();
      
      // Create photo bubbles ONLY from photos with real GPS coordinates
      const photoBubbles = [];

      dayDataList.forEach((dayData) => {
        if (dayData.photos && Array.isArray(dayData.photos)) {
          dayData.photos.forEach((photo) => {
            // Only add bubble if photo has real GPS coordinates
            if (photo.lat !== null && photo.lon !== null && 
                typeof photo.lat === 'number' && typeof photo.lon === 'number') {
              photoBubbles.push({
                coords: [photo.lon, photo.lat], // [longitude, latitude] for Mapbox
                photoCount: 1, // One photo per bubble
                date: dayData.date,
                title: dayData.title,
                photoId: photo.id,
                photoUrl: photo.url,
                photoTaken: photo.taken_at
              });
            }
          });
        }
      });
      
      console.log(`Found ${photoBubbles.length} photos with real GPS coordinates out of ${totalPhotoCount} total photos`);
      
      // Update the GPS photo count in the adventure card
      const gpsPhotoCountElement = document.getElementById('gps-photo-count');
      if (gpsPhotoCountElement) {
        gpsPhotoCountElement.textContent = photoBubbles.length;
      }

      const dayCountEl = document.getElementById('day-count');
      if (dayCountEl) dayCountEl.textContent = stacks.length;

      const cityCountEl = document.getElementById('city-count');
      if (cityCountEl) cityCountEl.textContent = uniqueCityCount;
      
      map.on('style.load', () => {
        // Apply some visual enhancements
        map.setFog({
          color: 'rgb(186, 210, 235)', // Lower atmosphere
          'high-color': 'rgb(36, 92, 223)', // Upper atmosphere
          'horizon-blend': 0.02, // Atmosphere thickness (default 0.2 at low zooms)
          'space-color': 'rgb(5, 5, 15)', // Darker space background
          'star-intensity': 1.0 // Maximum star brightness for beautiful starry effect
        });
        
        // Make map boundaries more subtle and fade into background
        setTimeout(() => {
          // Reduce country boundary visibility
          if (map.getLayer('country-boundaries')) {
            map.setPaintProperty('country-boundaries', 'line-opacity', 0.1);
            map.setPaintProperty('country-boundaries', 'line-color', 'rgba(255,255,255,0.05)');
          }
          
          // Reduce admin boundaries visibility
          if (map.getLayer('admin-0-boundary')) {
            map.setPaintProperty('admin-0-boundary', 'line-opacity', 0.08);
            map.setPaintProperty('admin-0-boundary', 'line-color', 'rgba(255,255,255,0.03)');
          }
          
          if (map.getLayer('admin-0-boundary-bg')) {
            map.setPaintProperty('admin-0-boundary-bg', 'line-opacity', 0.05);
          }
          
          if (map.getLayer('admin-0-boundary-disputed')) {
            map.setPaintProperty('admin-0-boundary-disputed', 'line-opacity', 0.05);
          }
          
          // Reduce state/province boundaries
          if (map.getLayer('admin-1-boundary')) {
            map.setPaintProperty('admin-1-boundary', 'line-opacity', 0.03);
          }
          
          if (map.getLayer('admin-1-boundary-bg')) {
            map.setPaintProperty('admin-1-boundary-bg', 'line-opacity', 0.02);
          }
          
          // Make coastlines more subtle
          if (map.getLayer('water')) {
            map.setPaintProperty('water', 'fill-opacity', 0.6);
          }
          
          // Reduce any other boundary layers
          const layers = map.getStyle().layers;
          layers.forEach(layer => {
            if (layer.id.includes('boundary') && layer.type === 'line') {
              map.setPaintProperty(layer.id, 'line-opacity', 0.05);
            }
          });
        }, 100); // Small delay to ensure all layers are loaded
        
        // Add photo bubbles ONLY for photos with real GPS coordinates
        if (photoBubbles.length === 0) {
          console.log('No photos with GPS coordinates found - no photo bubbles will be displayed');
        } else {
          console.log(`Creating ${photoBubbles.length} photo bubbles with real GPS coordinates`);
        }
        
        photoBubbles.forEach((bubble, index) => {
          // Create custom marker element for photo bubble
          const el = document.createElement('div');
          el.className = 'globe-marker photo-bubble';
          el.style.animationDelay = `${index * 0.2}s`;
          
          // Standard size for individual photos (all are single photos now)
          const size = 10; // Fixed size since each bubble represents one photo
          el.style.width = size + 'px';
          el.style.height = size + 'px';
          
          // Format the date for display
          const photoDate = new Date(bubble.photoTaken || bubble.date);
          const displayDate = photoDate.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          // Create popup with real photo information
          const popup = new mapboxgl.Popup({ 
            offset: 15,
            closeButton: false,
            closeOnClick: true
          }).setHTML(`
            <div style="color:#0f172a;font-weight:600;font-size:0.9rem;padding:4px 8px;">
              <div style="font-weight:700;margin-bottom:4px;">📸 Photo</div>
              <div style="color:#6b7280;font-size:0.8rem;">${displayDate}</div>
              <div style="color:#6b7280;font-size:0.75rem;">${bubble.title}</div>
              <div style="color:#22c55e;font-size:0.75rem;margin-top:2px;">Real GPS location</div>
            </div>
          `);
          
          // Create marker with interactivity
          const marker = new mapboxgl.Marker(el)
            .setLngLat(bubble.coords)
            .setPopup(popup)
            .addTo(map);
          
          // Add hover effects
          el.addEventListener('mouseenter', () => {
            popup.addTo(map);
          });
          
          el.addEventListener('mouseleave', () => {
            popup.remove();
          });
          
          // Add click to explore photos
          el.addEventListener('click', () => {
            // Navigate to the main trip view
            window.location.href = `/index.html?trip=japan-korea`;
          });
        });
        
        console.log(`Added ${photoBubbles.length} photo bubbles representing ${totalPhotoCount} photos`);
      });
      
      // Auto-rotate the globe slowly to showcase the travel regions
      let userInteracted = false;
      const spinGlobe = () => {
        const zoom = map.getZoom();
        if (!userInteracted && zoom < 4) { // Higher zoom threshold for better rotation
          const center = map.getCenter();
          center.lng -= 0.1; // Even slower rotation for the zoomed-in view
          map.easeTo({ center, duration: 2000 }); // Longer duration for smoother rotation
        }
      };
      
      // Start rotation after a brief delay
      setTimeout(() => {
        const spinInterval = setInterval(spinGlobe, 3000); // Longer interval for zoomed-in view
      }, 1500); // Longer initial delay to let user see the initial view
      
      // Stop rotation on user interaction
      map.on('mousedown', () => {
        userInteracted = true;
        setTimeout(() => { userInteracted = false; }, 20000); // Resume after 20s of inactivity
      });
      
      map.on('wheel', () => {
        userInteracted = true;
        setTimeout(() => { userInteracted = false; }, 20000);
      });
      
      // Handle resize
      window.addEventListener('resize', () => {
        map.resize();
      });
    }
    
    // Initialize globe when page loads
    document.addEventListener('DOMContentLoaded', () => {
      if (window.mapboxgl) {
        initGlobe();
      }
    });
  </script>
</body>
</html>
